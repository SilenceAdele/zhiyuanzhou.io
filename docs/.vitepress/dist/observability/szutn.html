<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>prometheus tsdb - Head Block | zhiyuan.zhou's Blog</title>
    
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.ByA2-10k.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    <script type="module" src="/assets/chunks/metadata.938adf87.js"></script>
    <script type="module" src="/assets/app.Cp6pEj3m.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CiQHzwf1.js">
    <link rel="modulepreload" href="/assets/chunks/framework.DTUrUyLr.js">
    <link rel="modulepreload" href="/assets/observability_szutn.md.CPgqM__u.lean.js">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
    <script>window.addEventListener("DOMContentLoaded",()=>{typeof LA<"u"&&LA.init({id:"3LmZHLhDZIDpMaT0",ck:"3LmZHLhDZIDpMaT0",autoTrack:!0,hashMode:!0,screenRecord:!0})});</script>
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="author" content="Tianke">
    <meta property="og:description" content="zhiyuan.zhou's Blog">
    <meta property="og:image" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="description" description="欢迎来到 vitepress-theme-teek 使用文档,Teek 是一个基于 VitePress 构建的主题，是在默认主题的基础上进行拓展，支持 VitePress 的所有功能、配置,Teek 拥有三种典型的知识管理形态：结构化、碎片化、体系化，可以轻松构建一个结构化知识库，适用个人博客、文档站、知识库等场景">
    <meta name="keywords" description="欢迎来到 vitepress-theme-teek 使用文档,Teek 是一个基于 VitePress 构建的主题，是在默认主题的基础上进行拓展，支持 VitePress 的所有功能、配置,Teek 拥有三种典型的知识管理形态：结构化、碎片化、体系化，可以轻松构建一个结构化知识库，适用个人博客、文档站、知识库等场景">
    <meta name="baidu-site-verification" content="codeva-QnY1Xh758j">
    <meta name="msvalidate.01" content="48CABE70F538B8D117567176ABF325AF">
    <link rel="icon" href="/img/hano.webp" type="image/png">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2989306_w303erbip9.css">
    <script src="https://at.alicdn.com/t/c/font_4899452_xj7acblxpxj.js" media="print" onload="this.media='all'"></script>
    <noscript><meta http-equiv="refresh" content="0; url={https://www.baidu.com/}"></noscript>
    <noscript><meta name="algolia-site-verification"  content="74FDAC5EA37E820E" /></noscript>
    <script src="https://at.alicdn.com/t/c/font_4686603_33kna2v5qcm.js" defer></script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body><!--teleport start anchor--><div style="display:none;" class="tk-spotlight-hover tk-spotlight-hover__aside" aria-hidden="true" focusable="false"></div><!--teleport anchor-->
    <div id="app"><!--[--><!--v-if--><!--v-if--><!--v-if--><!--[--><!--v-if--><!----><!--v-if--><div class="tk-right-bottom-button tk-wallpaper-outside flx-column"><!--[--><!--]--><div class="vitepress-backTop-main" title="返回顶部" style="display:none;" data-v-944b0889><svg class="progress-circle" width="70" height="70" viewBox="0 0 70 70" data-v-944b0889><circle class="progress-circle-bg" cx="35" cy="35" r="30" fill="none" stroke="rgba(255, 255, 255, 0.2)" stroke-width="4" data-v-944b0889></circle><circle class="progress-circle-bar" cx="35" cy="35" r="30" fill="none" stroke="rgba(255, 255, 255, 0.9)" stroke-width="4" stroke-dasharray="188.49555921538757" stroke-dashoffset="188.49555921538757" transform="rotate(-90 35 35)" data-v-944b0889></circle></svg><svg class="icon" width="200" height="200" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-944b0889><path fill="#FFF" d="M752.736 431.063C757.159 140.575 520.41 8.97 504.518 0.41V0l-0.45 0.205-0.41-0.205v0.41c-15.934 8.56-252.723 140.165-248.259 430.653-48.21 31.457-98.713 87.368-90.685 184.074 8.028 96.666 101.007 160.768 136.601 157.287 35.595-3.482 25.232-30.31 25.232-30.31l12.206-50.095s52.47 80.569 69.304 80.528c15.114-1.23 87-0.123 95.6 0h0.82c8.602-0.123 80.486-1.23 95.6 0 16.794 0 69.305-80.528 69.305-80.528l12.165 50.094s-10.322 26.83 25.272 30.31c35.595 3.482 128.574-60.62 136.602-157.286 8.028-96.665-42.475-152.617-90.685-184.074z m-248.669-4.26c-6.758-0.123-94.781-3.359-102.891-107.192 2.95-98.714 95.97-107.438 102.891-107.93 6.964 0.492 99.943 9.216 102.892 107.93-8.11 103.833-96.174 107.07-102.892 107.192z m-52.019 500.531c0 11.838-9.42 21.382-21.012 21.382a21.217 21.217 0 0 1-21.054-21.34V821.74c0-11.797 9.421-21.382 21.054-21.382 11.591 0 21.012 9.585 21.012 21.382v105.635z m77.333 57.222a21.504 21.504 0 0 1-21.34 21.626 21.504 21.504 0 0 1-21.34-21.626V827.474c0-11.96 9.543-21.668 21.299-21.668 11.796 0 21.38 9.708 21.38 21.668v157.082z m71.147-82.043c0 11.796-9.42 21.34-21.053 21.34a21.217 21.217 0 0 1-21.013-21.34v-75.367c0-11.755 9.421-21.299 21.013-21.299 11.632 0 21.053 9.544 21.053 21.3v75.366z" data-v-944b0889></path></svg></div><div title="前往评论" class="tk-right-bottom-button__button" role="button" aria-label="前往评论" style="display:none;"><i class="tk-icon" style="--icon-color-hover:var(--tk-theme-color);" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="M273.536 736H800a64 64 0 0 0 64-64V256a64 64 0 0 0-64-64H224a64 64 0 0 0-64 64v570.88zM296 800 147.968 918.4A32 32 0 0 1 96 893.44V256a128 128 0 0 1 128-128h576a128 128 0 0 1 128 128v416a128 128 0 0 1-128 128z"
    ></path>
    <path
      fill="currentColor"
      d="M512 499.2a51.2 51.2 0 1 1 0-102.4 51.2 51.2 0 0 1 0 102.4zm192 0a51.2 51.2 0 1 1 0-102.4 51.2 51.2 0 0 1 0 102.4zm-384 0a51.2 51.2 0 1 1 0-102.4 51.2 51.2 0 0 1 0 102.4z"
    ></path>
  </svg></i></div><!--v-if--><!--[--><!--]--></div><!--]--><div class="Layout tk-layout tk-layout--hide-vp-home has-sidebar-trigger" data-v-642bba31><!--[--><!--[--><div class="progress-bar" style="width:0%;" data-v-95379498></div><!----><RouteSwitchingLoading></RouteSwitchingLoading><!--]--><!--v-if--><!--]--><!--[--><span tabindex="-1" data-v-9b2879cd></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-9b2879cd>Skip to content</a><!--]--><!----><header class="VPNav" data-v-642bba31 data-v-9087e14e><div class="VPNavBar" data-v-9087e14e data-v-4b88a11b><div class="wrapper" data-v-4b88a11b><div class="container" data-v-4b88a11b><div class="title" data-v-4b88a11b><div class="VPNavBarTitle has-sidebar" data-v-4b88a11b data-v-0c74fe16><a class="title" href="/" data-v-0c74fe16><!--[--><!--]--><!--[--><img class="VPImage logo" src="/img/hano.webp" alt data-v-c2c3a147><!--]--><span data-v-0c74fe16>zhiyuan.zhou&#39;s Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-4b88a11b><div class="content-body" data-v-4b88a11b><!--[--><!--]--><div class="VPNavBarSearch search" data-v-4b88a11b><!--[--><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-4b88a11b data-v-a3c1d848><span id="main-nav-aria-label" class="visually-hidden" data-v-a3c1d848> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-a3c1d848 data-v-41e3bce1><!--[--><span data-v-41e3bce1>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a3c1d848 data-v-a4a31efc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-a4a31efc><span class="text" data-v-a4a31efc><!----><span data-v-a4a31efc>知识库</span><span class="vpi-chevron-down text-icon" data-v-a4a31efc></span></span></button><div class="menu" data-v-a4a31efc><div class="VPMenu" data-v-a4a31efc data-v-ed328144><div class="items" data-v-ed328144><!--[--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/kubernetes/kubernetes-index" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/kubernetes.svg" alt="" style="width: 16px; height: 16px;">
              <span>云原生(kubernetes)</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/observability/observability-index" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/Prometheus.png" alt="" style="width: 16px; height: 16px;">
              <span>云原生可观测(prometheus)</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/cloud-storage/cloud-storage-index" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/cloud-storage.svg" alt="" style="width: 16px; height: 16px;">
              <span>云存储</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/middleware/middleware-index" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/middleware.svg" alt="" style="width: 16px; height: 16px;">
              <span>中间件</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/operating-system/operating-system-index" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/operating-system.svg" alt="" style="width: 16px; height: 16px;">
              <span>操作系统</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/computer-network/computer-network-index" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/computer-network.svg" alt="" style="width: 16px; height: 16px;">
              <span>计算机网络</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/coding/coding-index" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/coding.svg" alt="" style="width: 16px; height: 16px;">
              <span>计算机编程</span>
            </div>
            </span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a3c1d848 data-v-a4a31efc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-a4a31efc><span class="text" data-v-a4a31efc><!----><span data-v-a4a31efc>杂记</span><span class="vpi-chevron-down text-icon" data-v-a4a31efc></span></span></button><div class="menu" data-v-a4a31efc><div class="VPMenu" data-v-a4a31efc data-v-ed328144><div class="items" data-v-ed328144><!--[--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/troubleshooting/troubleshooting-index" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <span>🛠️ 故障排查(troubleshooting)</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/toss-note/toss-note-index" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/note.svg" alt="" style="width: 16px; height: 16px;">
              <span>折腾日记</span>
            </div>
            </span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a3c1d848 data-v-a4a31efc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-a4a31efc><span class="text" data-v-a4a31efc><!----><span data-v-a4a31efc>生活</span><span class="vpi-chevron-down text-icon" data-v-a4a31efc></span></span></button><div class="menu" data-v-a4a31efc><div class="VPMenu" data-v-a4a31efc data-v-ed328144><div class="items" data-v-ed328144><!--[--><!--[--><div class="VPMenuGroup" data-v-ed328144 data-v-3bf3cd4d><p class="title" data-v-3bf3cd4d>分享</p><!--[--><!--[--><div class="VPMenuLink" data-v-3bf3cd4d data-v-ac51f00f><a class="VPLink link" href="/share/photo" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
                <div style="display: flex; align-items: center; gap: 4px;">
                  <img src="/img/nav/picture.svg" alt="" style="width: 16px; height: 16px;">
                  <span>相册</span>
                </div>
                </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3bf3cd4d data-v-ac51f00f><a class="VPLink link" href="/share/movie" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
                <div style="display: flex; align-items: center; gap: 4px;">
                  <img src="/img/nav/movie.svg" alt="" style="width: 16px; height: 16px;">
                  <span>电影</span>
                </div>
                </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3bf3cd4d data-v-ac51f00f><a class="VPLink link" href="/share/music" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
                <div style="display: flex; align-items: center; gap: 4px;">
                  <img src="/img/nav/music.svg" alt="" style="width: 16px; height: 16px;">
                  <span>音乐</span>
                </div>
                </span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-ed328144 data-v-3bf3cd4d><p class="title" data-v-3bf3cd4d>心情</p><!--[--><!--[--><div class="VPMenuLink" data-v-3bf3cd4d data-v-ac51f00f><a class="VPLink link" href="/mood/essay" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
                <div style="display: flex; align-items: center; gap: 4px;">
                  <img src="/img/nav/essay.svg" alt="" style="width: 16px; height: 16px;">
                  <span>随笔</span>
                </div>
                </span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a3c1d848 data-v-a4a31efc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-a4a31efc><span class="text" data-v-a4a31efc><!----><span data-v-a4a31efc>导航</span><span class="vpi-chevron-down text-icon" data-v-a4a31efc></span></span></button><div class="menu" data-v-a4a31efc><div class="VPMenu" data-v-a4a31efc data-v-ed328144><div class="items" data-v-ed328144><!--[--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/categories" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/categorie.svg" alt="" style="width: 16px; height: 16px;">
              <span>分类页</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/tags" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/tag.svg" alt="" style="width: 16px; height: 16px;">
              <span>标签页</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/archives" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/archive.svg" alt="" style="width: 16px; height: 16px;">
              <span>归档页</span>
            </div>
            </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ed328144 data-v-ac51f00f><a class="VPLink link" href="/articleOverview" data-v-ac51f00f><!--[--><span data-v-ac51f00f>
            <div style="display: flex; align-items: center; gap: 4px;">
              <img src="/img/nav/list.svg" alt="" style="width: 16px; height: 16px;">
              <span>清单页</span>
            </div>
            </span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about/me" tabindex="0" data-v-a3c1d848 data-v-41e3bce1><!--[--><span data-v-41e3bce1>关于我</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-4b88a11b data-v-352482db><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-352482db data-v-d66c6f18 data-v-8fa56ef2><span class="check" data-v-8fa56ef2><span class="icon" data-v-8fa56ef2><!--[--><span class="vpi-sun sun" data-v-d66c6f18></span><span class="vpi-moon moon" data-v-d66c6f18></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-4b88a11b data-v-b07ad281 data-v-2f40524c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/SilenceAdele" aria-label target="_blank" rel="noopener" data-v-2f40524c data-v-ec524809><svg t="1743875298298" class="icon" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="2388" width="200" height="200">
  <path d="M512 12.8C229.12 12.8 0 241.92 0 524.8c0 226.56 146.56 418.56 350.72 486.4
  25.6 4.48 35.2-11.2 35.2-24.96 0-12.16-0.48-52.48-0.8-95.36-142.72 31.04-172.8-60.8-172.8-60.8
  -23.36-59.2-57.12-75.04-57.12-75.04-46.72-31.84 3.52-31.2 3.52-31.2 51.68 3.68 78.88 53.12 78.88 53.12
  45.92 78.72 120.48 56 149.92 42.88 4.48-33.28 18.08-56.32 32.96-69.28-113.92-13.12-233.92-56.96-233.92-253.44
  0-56 19.84-101.76 52.48-137.76-5.12-13.12-22.72-65.92 4.96-137.44 0 0 42.72-13.76 140.16 52.48
  40.64-11.36 84.16-17.12 127.36-17.28 43.2 0.16 86.72 5.92 127.36 17.28
  97.28-66.24 140-52.48 140-52.48 27.84 71.52 10.24 124.32 5.12 137.44
  32.64 36 52.32 81.76 52.32 137.76 0 197.12-120.16 240.16-234.56 252.8
  18.56 16 35.2 47.36 35.2 95.52 0 69.12-0.64 124.8-0.64 141.76 0 13.76 9.6 29.76 35.36 24.8
  C877.6 943.36 1024 751.36 1024 524.8 1024 241.92 794.88 12.8 512 12.8z"
  fill="#181717" p-id="2389"></path>
</svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-4b88a11b data-v-b4e3fd99 data-v-a4a31efc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-a4a31efc><span class="vpi-more-horizontal icon" data-v-a4a31efc></span></button><div class="menu" data-v-a4a31efc><div class="VPMenu" data-v-a4a31efc data-v-ed328144><!----><!--[--><!--[--><!----><div class="group" data-v-b4e3fd99><div class="item appearance" data-v-b4e3fd99><p class="label" data-v-b4e3fd99>主题</p><div class="appearance-action" data-v-b4e3fd99><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-b4e3fd99 data-v-d66c6f18 data-v-8fa56ef2><span class="check" data-v-8fa56ef2><span class="icon" data-v-8fa56ef2><!--[--><span class="vpi-sun sun" data-v-d66c6f18></span><span class="vpi-moon moon" data-v-d66c6f18></span><!--]--></span></span></button></div></div></div><div class="group" data-v-b4e3fd99><div class="item social-links" data-v-b4e3fd99><div class="VPSocialLinks social-links-list" data-v-b4e3fd99 data-v-2f40524c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/SilenceAdele" aria-label target="_blank" rel="noopener" data-v-2f40524c data-v-ec524809><svg t="1743875298298" class="icon" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="2388" width="200" height="200">
  <path d="M512 12.8C229.12 12.8 0 241.92 0 524.8c0 226.56 146.56 418.56 350.72 486.4
  25.6 4.48 35.2-11.2 35.2-24.96 0-12.16-0.48-52.48-0.8-95.36-142.72 31.04-172.8-60.8-172.8-60.8
  -23.36-59.2-57.12-75.04-57.12-75.04-46.72-31.84 3.52-31.2 3.52-31.2 51.68 3.68 78.88 53.12 78.88 53.12
  45.92 78.72 120.48 56 149.92 42.88 4.48-33.28 18.08-56.32 32.96-69.28-113.92-13.12-233.92-56.96-233.92-253.44
  0-56 19.84-101.76 52.48-137.76-5.12-13.12-22.72-65.92 4.96-137.44 0 0 42.72-13.76 140.16 52.48
  40.64-11.36 84.16-17.12 127.36-17.28 43.2 0.16 86.72 5.92 127.36 17.28
  97.28-66.24 140-52.48 140-52.48 27.84 71.52 10.24 124.32 5.12 137.44
  32.64 36 52.32 81.76 52.32 137.76 0 197.12-120.16 240.16-234.56 252.8
  18.56 16 35.2 47.36 35.2 95.52 0 69.12-0.64 124.8-0.64 141.76 0 13.76 9.6 29.76 35.36 24.8
  C877.6 943.36 1024 751.36 1024 524.8 1024 241.92 794.88 12.8 512 12.8z"
  fill="#181717" p-id="2389"></path>
</svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--[--><!--[--><!--[--><div id="clock" data-v-7063a575><div class="time" data-v-7063a575><span class="hour" data-v-7063a575>00</span><span class="separator" data-v-7063a575>:</span><span class="minute" data-v-7063a575>00</span><span class="separator" data-v-7063a575>:</span><span class="second" data-v-7063a575>00</span></div></div><!--]--><!--[--><div class="tk-theme-enhance flx-align-center"><!--[--><i class="tk-icon" style="--icon-size:20px;--icon-color-hover:var(--tk-theme-color);"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="m512 863.36 384-54.848v-638.72L525.568 222.72a96 96 0 0 1-27.136 0L128 169.792v638.72zM137.024 106.432l370.432 52.928a32 32 0 0 0 9.088 0l370.432-52.928A64 64 0 0 1 960 169.792v638.72a64 64 0 0 1-54.976 63.36l-388.48 55.488a32 32 0 0 1-9.088 0l-388.48-55.488A64 64 0 0 1 64 808.512v-638.72a64 64 0 0 1 73.024-63.36z"
    ></path>
    <path fill="currentColor" d="M480 192h64v704h-64z"></path>
  </svg></i><!--]--></div><!--teleport start--><!--teleport end--><!--]--><!--]--><!--]--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-4b88a11b data-v-607a2345><span class="container" data-v-607a2345><span class="top" data-v-607a2345></span><span class="middle" data-v-607a2345></span><span class="bottom" data-v-607a2345></span></span></button></div></div></div></div><div class="divider" data-v-4b88a11b><div class="divider-line" data-v-4b88a11b></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-642bba31 data-v-01712bd5><div class="container" data-v-01712bd5><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-01712bd5><span class="vpi-align-left menu-icon" data-v-01712bd5></span><span class="menu-text" data-v-01712bd5>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-01712bd5 data-v-d03daff1><button data-v-d03daff1>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-642bba31 data-v-7addc1b0><div class="curtain" data-v-7addc1b0></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-7addc1b0><span class="visually-hidden" id="sidebar-aria-label" data-v-7addc1b0> Sidebar Navigation </span><!--[--><!--[--><!--v-if--><!--]--><!--]--><!--[--><div class="no-transition group" data-v-43270cfc><section class="VPSidebarItem level-0" data-v-43270cfc data-v-e51909fd><!----><div class="items" data-v-e51909fd><!--[--><div class="VPSidebarItem level-1 collapsible collapsed is-link" data-v-e51909fd data-v-e51909fd><div class="item" data-v-e51909fd><div class="indicator" data-v-e51909fd></div><a class="VPLink link link" href="/observability/observability-index" data-v-e51909fd><!--[--><p class="text" data-v-e51909fd>observability</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-43270cfc><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-43270cfc data-v-e51909fd><div class="item" role="button" tabindex="0" data-v-e51909fd><div class="indicator" data-v-e51909fd></div><h2 class="text" data-v-e51909fd>prometheus</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e51909fd><span class="vpi-chevron-right caret-icon" data-v-e51909fd></span></div></div><div class="items" data-v-e51909fd><!--[--><section class="VPSidebarItem level-1 collapsible collapsed has-active" data-v-e51909fd data-v-e51909fd><div class="item" role="button" tabindex="0" data-v-e51909fd><div class="indicator" data-v-e51909fd></div><h3 class="text" data-v-e51909fd>tsdb</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e51909fd><span class="vpi-chevron-right caret-icon" data-v-e51909fd></span></div></div><div class="items" data-v-e51909fd><!--[--><div class="VPSidebarItem level-2 collapsible collapsed is-link" data-v-e51909fd data-v-e51909fd><div class="item" data-v-e51909fd><div class="indicator" data-v-e51909fd></div><a class="VPLink link link" href="/observability/szutn" data-v-e51909fd><!--[--><p class="text" data-v-e51909fd>prometheus tsdb - Head Block</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-642bba31 data-v-c7f2a90e><div class="VPDoc has-sidebar has-aside" data-v-c7f2a90e data-v-a0c76dcf><!--[--><!--]--><div class="container" data-v-a0c76dcf><div class="aside" data-v-a0c76dcf><div class="aside-curtain" data-v-a0c76dcf></div><div class="aside-container" data-v-a0c76dcf><div class="aside-content" data-v-a0c76dcf><div class="VPDocAside" data-v-a0c76dcf data-v-d050e82f><!--[--><!--]--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--]--><div class="tk-article-share"><button class="tk-article-share__button flx-center" aria-label="分享此页面" aria-live="polite"><div class="flx-center"><i class="tk-icon" style="margin-right:4px;--icon-color-hover:var(--tk-theme-color);"><svg
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    aria-hidden="true"
    role="img"
    class="iconify iconify iconify--solar"
    alt="Icon"
    width="1em"
    height="1em"
    viewBox="0 0 24 24"
    style="vertical-align: -0.125em"
  >
    <path
      fill="currentColor"
      fill-rule="evenodd"
      d="M13.803 5.333c0-1.84 1.5-3.333 3.348-3.333A3.34 3.34 0 0 1 20.5 5.333c0 1.841-1.5 3.334-3.349 3.334a3.35 3.35 0 0 1-2.384-.994l-4.635 3.156a3.34 3.34 0 0 1-.182 1.917l5.082 3.34a3.35 3.35 0 0 1 2.12-.753a3.34 3.34 0 0 1 3.348 3.334C20.5 20.507 19 22 17.151 22a3.34 3.34 0 0 1-3.348-3.333a3.3 3.3 0 0 1 .289-1.356L9.05 14a3.35 3.35 0 0 1-2.202.821A3.34 3.34 0 0 1 3.5 11.487a3.34 3.34 0 0 1 3.348-3.333c1.064 0 2.01.493 2.623 1.261l4.493-3.059a3.3 3.3 0 0 1-.161-1.023"
      clip-rule="evenodd"
    ></path>
  </svg></i> 分享此页面</div></button></div><!--[--><!--]--><!--]--><!--[--><!--]--><!--]--><!--]--><!--]--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-d050e82f data-v-c05314c6><div class="content" data-v-c05314c6><div class="outline-marker" data-v-c05314c6></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c05314c6>本页导航</div><ul class="VPDocOutlineItem root" data-v-c05314c6 data-v-53c3bcee><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-d050e82f></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-a0c76dcf><div class="content-container" data-v-a0c76dcf><!--[--><!--[--><!--[--><!--[--><!--]--><!--[--><!--[--><!--]--><div class="tk-article-analyze flx-justify-between" aria-label="文章分析"><div class="tk-article-breadcrumb" role="navigation" aria-label="文章面包屑"><div class="tk-breadcrumb" role="navigation" aria-label="面包屑"><!--[--><span class="tk-breadcrumb__item"><span class="tk-breadcrumb__inner" role="link"><!--[--><a href="/" title="首页" class="home hover-color" aria-label="首页"><i class="tk-icon" style="--icon-color-hover:var(--tk-theme-color);" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="M192 413.952V896h640V413.952L512 147.328zM139.52 374.4l352-293.312a32 32 0 0 1 40.96 0l352 293.312A32 32 0 0 1 896 398.976V928a32 32 0 0 1-32 32H160a32 32 0 0 1-32-32V398.976a32 32 0 0 1 11.52-24.576"
    ></path>
  </svg></i></a><!--]--></span><span class="tk-breadcrumb__separator" role="presentation">/</span></span><!--[--><span class="tk-breadcrumb__item"><span class="tk-breadcrumb__inner" role="link"><!--[--><span href title="云原生可观测" class="" aria-label="云原生可观测">云原生可观测</span><!--]--></span><span class="tk-breadcrumb__separator" role="presentation">/</span></span><span class="tk-breadcrumb__item"><span class="tk-breadcrumb__inner" role="link"><!--[--><span href title="prometheus" class="" aria-label="prometheus">prometheus</span><!--]--></span><span class="tk-breadcrumb__separator" role="presentation">/</span></span><span class="tk-breadcrumb__item"><span class="tk-breadcrumb__inner" role="link"><!--[--><span href title="tsdb" class="" aria-label="tsdb">tsdb</span><!--]--></span><span class="tk-breadcrumb__separator" role="presentation">/</span></span><!--]--><!--]--></div></div><div class="tk-article-analyze__wrapper flx-align-center"><div class="tk-article-info article" role="group" aria-label="文章信息"><!--[--><!--[--><!--v-if--><!--]--><!--[--><span class="tk-article-info__item" role="group" aria-label="创建时间"><i class="tk-icon tk-article-info__icon" style="--icon-color-hover:var(--tk-theme-color);" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
  <path
    fill="currentColor"
    d="M128 384v512h768V192H768v32a32 32 0 1 1-64 0v-32H320v32a32 32 0 0 1-64 0v-32H128v128h768v64zm192-256h384V96a32 32 0 1 1 64 0v32h160a32 32 0 0 1 32 32v768a32 32 0 0 1-32 32H96a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h160V96a32 32 0 0 1 64 0zm-32 384h64a32 32 0 0 1 0 64h-64a32 32 0 0 1 0-64m0 192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64m192-192h64a32 32 0 0 1 0 64h-64a32 32 0 0 1 0-64m0 192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64m192-192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64m0 192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64"
  ></path>
</svg></i><a title="创建时间" class="hover-color" aria-label="2025-11-14">2025-11-14</a></span><!--]--><!--[--><span class="tk-article-info__item" role="group" aria-label="更新时间"><i class="tk-icon tk-article-info__icon" style="--icon-color-hover:var(--tk-theme-color);" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="m199.04 672.64 193.984 112 224-387.968-193.92-112-224 388.032zm-23.872 60.16 32.896 148.288 144.896-45.696zM455.04 229.248l193.92 112 56.704-98.112-193.984-112-56.64 98.112zM104.32 708.8l384-665.024 304.768 175.936L409.152 884.8h.064l-248.448 78.336zm384 254.272v-64h448v64h-448z"
    ></path>
  </svg></i><a title="更新时间" class="hover-color" aria-label="2025-11-21">2025-11-21</a></span><!--]--><!--[--><span class="tk-article-info__item" role="group" aria-label="分类"><i class="tk-icon tk-article-info__icon" style="--icon-color-hover:var(--tk-theme-color);" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="M878.08 448H241.92l-96 384h636.16l96-384zM832 384v-64H485.76L357.504 192H128v448l57.92-231.744A32 32 0 0 1 216.96 384zm-24.96 512H96a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h287.872l128.384 128H864a32 32 0 0 1 32 32v96h23.04a32 32 0 0 1 31.04 39.744l-112 448A32 32 0 0 1 807.04 896"
    ></path>
  </svg></i><!--[--><a title="分类" href="/categories?category=%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B" class="or hover-color" aria-label="云原生可观测">云原生可观测</a><!--]--></span><!--]--><!--[--><span class="tk-article-info__item" role="group" aria-label="标签"><i class="tk-icon tk-article-info__icon" style="--icon-color-hover:var(--tk-theme-color);" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="M256 128v698.88l196.032-156.864a96 96 0 0 1 119.936 0L768 826.816V128zm-32-64h576a32 32 0 0 1 32 32v797.44a32 32 0 0 1-51.968 24.96L531.968 720a32 32 0 0 0-39.936 0L243.968 918.4A32 32 0 0 1 192 893.44V96a32 32 0 0 1 32-32"
    ></path>
  </svg></i><!--[--><a title="标签" href="/tags?tag=prometheus" class="or hover-color" aria-label="prometheus">prometheus</a><a title="标签" href="/tags?tag=tsdb" class="or hover-color" aria-label="tsdb">tsdb</a><!--]--></span><!--]--><!--]--><!--[--><!--]--></div><div class="flx-center"><i class="tk-icon" style="--icon-color-hover:var(--tk-theme-color);" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="m512 863.36 384-54.848v-638.72L525.568 222.72a96 96 0 0 1-27.136 0L128 169.792v638.72zM137.024 106.432l370.432 52.928a32 32 0 0 0 9.088 0l370.432-52.928A64 64 0 0 1 960 169.792v638.72a64 64 0 0 1-54.976 63.36l-388.48 55.488a32 32 0 0 1-9.088 0l-388.48-55.488A64 64 0 0 1 64 808.512v-638.72a64 64 0 0 1 73.024-63.36z"
    ></path>
    <path fill="currentColor" d="M480 192h64v704h-64z"></path>
  </svg></i><a title="文章字数" class="hover-color" aria-label="文章字数">1422</a></div><div class="flx-center"><i class="tk-icon" style="--icon-color-hover:var(--tk-theme-color);"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"
    ></path>
    <path fill="currentColor" d="M480 256a32 32 0 0 1 32 32v256a32 32 0 0 1-64 0V288a32 32 0 0 1 32-32"></path>
    <path fill="currentColor" d="M480 512h256q32 0 32 32t-32 32H480q-32 0-32-32t32-32"></path>
  </svg></i><a title="预计阅读时长" class="hover-color" aria-label="预计阅读时长">6.1m</a></div><div class="flx-center"><i class="tk-icon" style="--icon-color-hover:var(--tk-theme-color);"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="M512 160c320 0 512 352 512 352S832 864 512 864 0 512 0 512s192-352 512-352m0 64c-225.28 0-384.128 208.064-436.8 288 52.608 79.872 211.456 288 436.8 288 225.28 0 384.128-208.064 436.8-288-52.608-79.872-211.456-288-436.8-288zm0 64a224 224 0 1 1 0 448 224 224 0 0 1 0-448m0 64a160.192 160.192 0 0 0-160 160c0 88.192 71.744 160 160 160s160-71.808 160-160-71.744-160-160-160"
    ></path>
  </svg></i><a title="浏览量" class="hover-color" aria-label="浏览量">0</a></div></div></div><!--[--><!--]--><!--]--><!----><!----><!----><!--v-if--><!--[--><div class="tk-sidebar-trigger" title="侧边栏展开/折叠" role="button" aria-label="侧边栏展开/折叠"><div class="tk-right-bottom-button__button"><i class="tk-icon" style="--icon-color-hover:var(--tk-theme-color);" aria-hidden="true"><svg
    viewBox="0 0 48 48"
    display="inline-block"
    vertical-align="middle"
    min-width="1.2rem"
    width="1.2em"
    height="1.2em"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="4">
      <path d="M6 7h36M8 24h32" />
      <path stroke-linejoin="round" d="M13.99 30L8 24.005L14 18m20.01 0L40 23.995L34 30" />
      <path d="M6 41h36" />
    </g>
  </svg></i></div></div><!--]--><!--]--><!--]--><!--]--><main class="main" data-v-a0c76dcf><div style="position:relative;" class="vp-doc _observability_szutn" data-v-a0c76dcf><div><h1 id="prometheus-tsdb-head-block" tabindex="-1">prometheus tsdb - Head Block <a class="header-anchor" href="#prometheus-tsdb-head-block" aria-label="Permalink to &quot;prometheus tsdb - Head Block&quot;">​</a></h1><h2 id="一、概述" tabindex="-1">一、概述 <a class="header-anchor" href="#一、概述" aria-label="Permalink to &quot;一、概述&quot;">​</a></h2><p>prometheus v2.0引入了tsdb，以下是tsdb的全局模型介绍：</p><p><img src="https://cdn.jsdelivr.net/gh/SilenceAdele/zhiyuanzhou.io@master/docs/02.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B/prometheus/01.tsdb/image/01.prometheustsdb-HeadBlock/1763051529947.png" alt="1763051529947" width="1000" height="200" loading="lazy"></p><hr><h3 id="🧠-内存部分-head-block" tabindex="-1">🧠 内存部分：Head Block <a class="header-anchor" href="#🧠-内存部分-head-block" aria-label="Permalink to &quot;🧠 内存部分：Head Block&quot;">​</a></h3><ul><li>Head block 是数据库中的内存部分，用于存储最新写入的数据。</li><li>每个新写入的样本（粉色框），首先会进入 Head block（即在内存中暂存）。</li><li>这是数据进入系统的第一站。</li></ul><hr><h3 id="🧾-wal-write-ahead-log" tabindex="-1">🧾 WAL（Write-Ahead Log） <a class="header-anchor" href="#🧾-wal-write-ahead-log" aria-label="Permalink to &quot;🧾 WAL（Write-Ahead Log）&quot;">​</a></h3><ul><li>WAL 用于持久化写入日志，确保即使服务崩溃也能恢复数据。</li><li>每个样本在写入内存的同时也会写入 WAL。</li><li>WAL 的存在让写入操作具备“先写日志，再更新内存”的安全性。</li></ul><hr><h3 id="📦-磁盘部分-灰色块和蓝色块" tabindex="-1">📦 磁盘部分：灰色块和蓝色块 <a class="header-anchor" href="#📦-磁盘部分-灰色块和蓝色块" aria-label="Permalink to &quot;📦 磁盘部分：灰色块和蓝色块&quot;">​</a></h3><ul><li>内存中的数据在一段时间后会被</li></ul><p>刷新（flush）到磁盘，形成灰色的持久化块（immutable blocks）。</p><ul><li>刷新过程中会先生成</li></ul><p>Memory-Mapped Chunks（蓝色块），即内存映射的中间状态。</p><hr><h3 id="🔁-块的生命周期管理" tabindex="-1">🔁 块的生命周期管理 <a class="header-anchor" href="#🔁-块的生命周期管理" aria-label="Permalink to &quot;🔁 块的生命周期管理&quot;">​</a></h3><ul><li>当蓝色块或内存块变“老”时，会被进一步刷新为磁盘上的持久块。</li><li>这些磁盘块是不可变的（immutable），不会再被更改。</li><li>多个旧块会被合并（merge），优化存储结构。</li><li>最终，当这些块超过设定的保留期（retention period），就会被自动删除。</li></ul><hr><h3 id="✅-总结流程" tabindex="-1">✅ 总结流程 <a class="header-anchor" href="#✅-总结流程" aria-label="Permalink to &quot;✅ 总结流程&quot;">​</a></h3><ol><li>样本准备写入 → 内存 Head block</li><li>先写入 WAL 日志，保证持久性</li><li>再写入Head block</li><li>一段时间后，flush 为 memory-mapped chunks（蓝色）</li><li>再转化为磁盘持久块（灰色）</li><li>多个块合并压缩</li><li>到期后删除</li></ol><h2 id="二、head-block-样本寿命" tabindex="-1">二、Head block 样本寿命 <a class="header-anchor" href="#二、head-block-样本寿命" aria-label="Permalink to &quot;二、Head block 样本寿命&quot;">​</a></h2><p>以单个时间序列为例，适用于所有序列。</p><p><img src="https://cdn.jsdelivr.net/gh/SilenceAdele/zhiyuanzhou.io@master/docs/02.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B/prometheus/01.tsdb/image/01.prometheustsdb-HeadBlock/1763051562226.png" alt="1763051562226" width="1000" height="200" loading="lazy"></p><p>样本存储在称为“chunk”的压缩单元中。样本传入时，会被提取到“active chunk”（红色块）中。这是唯一可以主动写入数据的单元。</p><p>在将样本提交到chunk中时，我们还会将其记录在磁盘（棕色块）上的预写日志（Write-Ahead-Log ，简称WAL) 中，以实现持久性（这意味着即使机器突然崩溃，我们也可以从中恢复内存中的数据）。</p><p><img src="https://cdn.jsdelivr.net/gh/SilenceAdele/zhiyuanzhou.io@master/docs/02.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B/prometheus/01.tsdb/image/01.prometheustsdb-HeadBlock/1763051674580.png" alt="1763051674580" width="1000" height="200" loading="lazy"></p><p>一旦一个块（chunk）填满了 120 个样本，或者跨越了 chunk/block 范围（这里我们称之为 chunkRange，默认是 2 小时），就会切割出一个新的块，而旧的块就被认为是“已满”的。</p><p>在这篇博客中，我们假设抓取间隔（scrape interval）是 15 秒，因此 120 个样本（一个完整的块）大约会覆盖 30 分钟。</p><p>带有数字 1 的黄色块表示刚刚填满的完整块，而红色的块表示新创建的块。</p><p><img src="https://cdn.jsdelivr.net/gh/SilenceAdele/zhiyuanzhou.io@master/docs/02.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B/prometheus/01.tsdb/image/01.prometheustsdb-HeadBlock/1763051734225.png" alt="1763051734225" width="1000" height="200" loading="lazy"></p><p>从 Prometheus v2.19.0 开始，我们不再把所有的块（chunk）都存放在内存中。</p><p>一旦切割出一个新块，已满的块就会被刷新到磁盘上，并通过内存映射（memory-mapping）的方式从磁盘加载，同时在内存中只保存一个引用。</p><p>借助内存映射，我们在需要时可以通过这个引用，把块动态地加载到内存中；这是操作系统提供的一种功能。</p><p><img src="https://cdn.jsdelivr.net/gh/SilenceAdele/zhiyuanzhou.io@master/docs/02.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B/prometheus/01.tsdb/image/01.prometheustsdb-HeadBlock/1763051755736.png" alt="1763051755736" width="1000" height="200" loading="lazy"></p><p>同样地，随着新的样本不断到来，就会不断切割出新的块（chunk）。</p><p><img src="https://cdn.jsdelivr.net/gh/SilenceAdele/zhiyuanzhou.io@master/docs/02.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B/prometheus/01.tsdb/image/01.prometheustsdb-HeadBlock/1763051770953.png" alt="1763051770953" width="1000" height="200" loading="lazy"></p><p>它们会被刷新到磁盘上，并通过内存映射的方式进行加载。</p><p><img src="https://cdn.jsdelivr.net/gh/SilenceAdele/zhiyuanzhou.io@master/docs/02.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B/prometheus/01.tsdb/image/01.prometheustsdb-HeadBlock/1763051785870.png" alt="1763051785870" width="1000" height="200" loading="lazy"></p><p>一段时间后，Head 块会像上图那样。假设红色的块已经快要填满，那么此时 Head 中就有 3 小时的数据（6 个块，每个块跨度为 30 分钟）。这相当于 <strong>chunkRange × 3/2</strong>。</p><p><img src="https://cdn.jsdelivr.net/gh/SilenceAdele/zhiyuanzhou.io@master/docs/02.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B/prometheus/01.tsdb/image/01.prometheustsdb-HeadBlock/1763051800905.png" alt="1763051800905" width="1000" height="200" loading="lazy"></p><p><img src="https://cdn.jsdelivr.net/gh/SilenceAdele/zhiyuanzhou.io@master/docs/02.%E4%BA%91%E5%8E%9F%E7%94%9F%E5%8F%AF%E8%A7%82%E6%B5%8B/prometheus/01.tsdb/image/01.prometheustsdb-HeadBlock/1763051811858.png" alt="1763051811858" width="1000" height="200" loading="lazy">当 Head 中的数据跨度达到 <strong>chunkRange × 3/2</strong> 时，最早的一个 chunkRange 的数据（这里是 2 小时）会被压缩（compacted）成一个持久化块（persistent block）。如果你注意到上文，这个时候 WAL（预写日志）会被截断（truncate），并创建一个“检查点”（checkpoint）（图中未展示）。我会在后续的博客中详细介绍 <strong>checkpoint、WAL 截断、压缩、持久化块以及它的索引</strong>。</p><p>这种数据的摄取（ingestion）、内存映射、压缩形成持久化块的循环会不断进行。而这正是 Head 块 的基本功能。</p><p><strong>参考文献：</strong></p><p><a href="https://ganeshvernekar.com/blog/prometheus-tsdb-the-head-block/" target="_blank" rel="noreferrer">https://ganeshvernekar.com/blog/prometheus-tsdb-the-head-block/</a></p></div></div></main><footer class="VPDocFooter" data-v-a0c76dcf data-v-78090c4e><!--[--><!--[--><!--[--><!--[--><!--[--><div class="shiguang-public" data-v-0ff339c1><div class="copyright-card" data-v-0ff339c1><span class="copyright-symbol shiguang-icon shiguang-icon-public" data-v-0ff339c1></span><div class="copyright-content" data-v-0ff339c1><div class="copyright-item" data-v-0ff339c1><span class="copyright-meta" data-v-0ff339c1><span class="shiguang-icon shiguang-icon-user" data-v-0ff339c1></span><span class="meta-text" data-v-0ff339c1>本文作者</span>: </span><span class="copyright-info" data-v-0ff339c1><a href="https://blog.zhiyuanzhou.online/" target="_blank" rel="noopener" data-v-0ff339c1>zhiyuan.zhou</a></span></div><div class="copyright-item" data-v-0ff339c1><span class="copyright-meta" data-v-0ff339c1><span class="shiguang-icon shiguang-icon-title" data-v-0ff339c1></span><span class="meta-text" data-v-0ff339c1>本文标题</span>: </span><span class="copyright-info" data-v-0ff339c1>prometheus tsdb - Head Block</span></div><div class="copyright-item" data-v-0ff339c1><span class="copyright-meta" data-v-0ff339c1><span class="shiguang-icon shiguang-icon-link" data-v-0ff339c1></span><span class="meta-text" data-v-0ff339c1>本文链接</span>: </span><span class="copyright-info" data-v-0ff339c1><a href="https://blog.zhiyuanzhou.online/observability/szutn" target="_blank" rel="noopener" data-v-0ff339c1>https://blog.zhiyuanzhou.online/observability/szutn</a></span></div><div class="copyright-item" data-v-0ff339c1><span class="copyright-meta" data-v-0ff339c1><span class="shiguang-icon shiguang-icon-cc" data-v-0ff339c1></span><span class="meta-text" data-v-0ff339c1>版权声明</span>: </span><span class="copyright-info" data-v-0ff339c1> 本站文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" data-v-0ff339c1>CC BY-NC-SA 4.0</a> 协议，转载请注明来自 <a href="https://blog.zhiyuanzhou.online" target="_blank" rel="noopener" data-v-0ff339c1>zhiyuan.zhou&#39;s Blog</a>！ </span></div></div></div></div><!--]--><!--v-if--><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-78090c4e><div class="edit-link" data-v-78090c4e><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/SilenceAdele" target="_blank" rel="noreferrer" data-v-78090c4e><!--[--><span class="vpi-square-pen edit-link-icon" data-v-78090c4e></span> 在 GitHub 上编辑此页<!--]--></a></div><div class="last-updated" data-v-78090c4e><p class="VPLastUpdated" data-v-78090c4e data-v-13463f1b>最后更新于: <time datetime="2025-11-21T00:56:33.000Z" data-v-13463f1b></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-78090c4e><span class="visually-hidden" id="doc-footer-aria-label" data-v-78090c4e>Pager</span><div class="pager" data-v-78090c4e><a class="VPLink link pager-link prev" href="/observability/observability-index" data-v-78090c4e><!--[--><span class="desc" data-v-78090c4e>上一页</span><span class="title" data-v-78090c4e>observability</span><!--]--></a></div><div class="pager" data-v-78090c4e><!----></div></nav></footer><!--[--><!--[--><!--[--><!--[--><!--]--><!--[--><!--[--><!--]--><div class="tk-article-update"><div class="tk-article-update__title flx-align-center"><i class="tk-icon edit-icon" style="--icon-color-hover:var(--tk-theme-color);" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
    <path
      fill="currentColor"
      d="m199.04 672.64 193.984 112 224-387.968-193.92-112-224 388.032zm-23.872 60.16 32.896 148.288 144.896-45.696zM455.04 229.248l193.92 112 56.704-98.112-193.984-112-56.64 98.112zM104.32 708.8l384-665.024 304.768 175.936L409.152 884.8h.064l-248.448 78.336zm384 254.272v-64h448v64h-448z"
    ></path>
  </svg></i><a href="/archives" class="hover-color" aria-label="最近更新">最近更新</a></div><ul><!--[--><li class="flx-center"><span class="tk-article-update--num" aria-hidden="true">01</span><div class="tk-article-update__content"><a href="/middleware/middleware-index" class="flx-1 hover-color sle" aria-label="middleware"><span class="tk-article-title" aria-label="文章标题"><!--v-if--><!--[--><!--[-->middleware<!--]--><!--]--><!--v-if--></span></a><span class="tk-article-update__content--date">2025-11-04 14:17:37</span></div></li><li class="flx-center"><span class="tk-article-update--num" aria-hidden="true">02</span><div class="tk-article-update__content"><a href="/coding/spwch" class="flx-1 hover-color sle" aria-label="goroutinue"><span class="tk-article-title" aria-label="文章标题"><!--v-if--><!--[--><!--[-->goroutinue<!--]--><!--]--><!--v-if--></span></a><span class="tk-article-update__content--date">2025-10-29 00:44:58</span></div></li><li class="flx-center"><span class="tk-article-update--num" aria-hidden="true">03</span><div class="tk-article-update__content"><a href="/mood/essay" class="flx-1 hover-color sle" aria-label="essay"><span class="tk-article-title" aria-label="文章标题"><!--v-if--><!--[--><!--[-->essay<!--]--><!--]--><!--v-if--></span></a><span class="tk-article-update__content--date">2025-10-28 23:39:34</span></div></li><li class="flx-center"><span class="tk-article-update--num" aria-hidden="true"></span><div class="tk-article-update__content"><a href="/archives" class="flx-1 hover-color sle" aria-label="更多文章 &gt;"><span class="tk-article-title" aria-label="文章标题"><!--v-if--><!--[--><!--[-->更多文章 &gt;<!--]--><!--]--><!--v-if--></span></a><!--v-if--></div></li><!--]--></ul></div><!--[--><!--]--><!--]--><!--v-if--><!-- 评论区 --><!--[--><!--[--><!--]--><!--[--><div id="twikoo"></div><!--]--><!--[--><!--]--><!--]--><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div><!--]--></div>
    
    
  </body>
</html>